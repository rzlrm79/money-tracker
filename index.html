<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Money Tracker</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#8FCFB6">

<style>
/* ===== RESET & MOBILE SAFE ===== */
*{
  box-sizing:border-box;
  -webkit-tap-highlight-color: transparent;
}

body{
  margin:0;
  padding:16px;
  font-family:system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:#F6F8F3;
  color:#2E3A34;
}

/* ===== HEADER ===== */
h1{
  text-align:center;
  color:#2F7D64;
  margin-bottom:20px;
}

/* ===== CARD ===== */
.card{
  background:#FFFFFF;
  border-radius:18px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 6px 18px rgba(0,0,0,.06);
  border:1px solid #E2E8E4;
}

/* ===== FORM ===== */
input,
select,
button{
  width:100%;
  padding:14px 16px;
  margin-top:10px;
  border-radius:14px;
  border:1px solid #E2E8E4;
  font-size:16px; /* penting: cegah auto zoom Android */
}

input,
select{
  background:#F9FBF7;
}

button{
  background:#8FCFB6;
  color:#FFFFFF;
  font-weight:600;
  border:none;
}

button:active{
  background:#78BDA2;
}

/* ===== LIST ===== */
.item{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  margin-top:12px;
  padding-bottom:8px;
  border-bottom:1px dashed #E2E8E4;
}

.income{ color:#2F7D64; }
.expense{ color:#E57373; }

/* ===== CHART ===== */
.bar{
  height:12px;
  background:linear-gradient(90deg,#8FCFB6,#6FB59B);
  border-radius:8px;
  margin-bottom:12px;
}

/* ===== TEXT ===== */
small{
  opacity:.75;
  font-size:13px;
}
</style>
</head>

<body>

<h1>ðŸ’° Money Tracker</h1>

<div class="card">
  <h3>Saldo</h3>
  <h2 id="saldo">Rp 0</h2>
</div>

<div class="card">
  <h3>Tambah Transaksi</h3>
  <input id="desc" placeholder="Keterangan">
  <input id="amount" type="number" placeholder="Jumlah">

  <select id="type">
    <option value="income">Pemasukan</option>
    <option value="expense">Pengeluaran</option>
  </select>

  <select id="category">
    <option>Makan</option>
    <option>Transport</option>
    <option>Rumah</option>
    <option>Gaji</option>
    <option>Lainnya</option>
  </select>

  <button onclick="addTx()">Tambah</button>
</div>

<div class="card">
  <h3>Grafik Pengeluaran</h3>

  <select id="monthFilter" onchange="render()">
    <option value="all">Semua Bulan</option>
  </select>

  <div id="chart"></div>
</div>

<div class="card">
  <h3>Riwayat</h3>
  <div id="list"></div>
  <small>Tap = hapus â€¢ Tahan = edit</small>
</div>

<script>
let data = JSON.parse(localStorage.getItem('money-data') || '[]');

function rupiah(n){
  return 'Rp ' + n.toLocaleString('id-ID');
}

  function normalizeDates(){
  let changed = false;

  data = data.map(d=>{
    if(!d.date){
      changed = true;
      return {
        ...d,
        date: new Date().toISOString()
      };
    }
    return d;
  });

  if(changed){
    localStorage.setItem('money-data', JSON.stringify(data));
  }
  }

function render(){
  let saldo = 0;
  const list = document.getElementById('list');
  list.innerHTML = '';

  data.forEach((d,i)=>{
    saldo += d.type==='income' ? d.amount : -d.amount;

    const div = document.createElement('div');
    div.className = 'item ' + d.type;
    div.innerHTML = `
      <span>${d.desc}<br><small>${d.category}</small></span>
      <span>${rupiah(d.amount)}</span>
    `;

    div.onclick = () => {
      if(confirm('Hapus transaksi ini?')){
        data.splice(i,1);
        save();
      }
    };

    div.ontouchstart = () => div._t = setTimeout(()=>editTx(i),600);
    div.ontouchend = () => clearTimeout(div._t);

    list.appendChild(div);
  });

  document.getElementById('saldo').innerText = rupiah(saldo);

  fillMonthFilter();
  drawChart();
}

function fillMonthFilter(){
  const sel = document.getElementById('monthFilter');
  const months = new Set();

  data.forEach(d=>{
    if(d.date) months.add(d.date.slice(0,7));
  });

  const current = sel.value;
  sel.innerHTML = '<option value="all">Semua Bulan</option>';

  [...months].sort().reverse().forEach(m=>{
    const opt = document.createElement('option');
    opt.value = m;
    opt.text = new Date(m+'-01')
      .toLocaleDateString('id-ID',{month:'long',year:'numeric'});
    sel.appendChild(opt);
  });

  sel.value = current || 'all';
}

function drawChart(){
  const box = document.getElementById('chart');
  const filter = document.getElementById('monthFilter').value;
  box.innerHTML = '';

  let exp = data.filter(d=>d.type==='expense');

  if(filter !== 'all'){
    exp = exp.filter(d=>d.date && d.date.startsWith(filter));
  }

  if(!exp.length){
    box.innerHTML = '<small>Tidak ada pengeluaran</small>';
    return;
  }

  const map = {};
  exp.forEach(d=>{
    map[d.category] = (map[d.category]||0) + d.amount;
  });

  const max = Math.max(...Object.values(map));

  Object.entries(map).forEach(([cat,val])=>{
    box.innerHTML += `
      <small>${cat} â€” ${rupiah(val)}</small>
      <div class="bar" style="width:${val/max*100}%"></div>
    `;
  });
}

function addTx(){
  const desc = document.getElementById('desc').value;
  const amount = Number(document.getElementById('amount').value);
  const type = document.getElementById('type').value;
  const category = document.getElementById('category').value;

  if(!desc || !amount) return alert('Lengkapi data');

  data.unshift({
    desc,
    amount,
    type,
    category,
    date: new Date().toISOString()
  });

  document.getElementById('desc').value='';
  document.getElementById('amount').value='';
  save();
}

function editTx(i){
  const d = data[i];
  const desc = prompt('Keterangan', d.desc);
  if(desc===null) return;
  const amt = prompt('Jumlah', d.amount);
  if(amt===null) return;

  data[i] = {...d, desc, amount:Number(amt)};
  save();
}

function save(){
  localStorage.setItem('money-data', JSON.stringify(data));
  render();
}
normalizeDates();
render();
</script>

</body>
</html>
