<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#020617">
<title>Money Tracker</title>

<style>
body{margin:0;padding:16px;font-family:Arial;background:#020617;color:#e5e7eb}
h1{text-align:center}
.card{background:#020617;border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 0 25px #000}
input,select,button{width:100%;padding:12px;margin-top:8px;border-radius:10px;border:none}
button{background:#22c55e;color:#020617;font-weight:bold}
.item{display:flex;justify-content:space-between;margin-top:8px}
.income{color:#22c55e}
.expense{color:#ef4444}
.bar{height:10px;background:#22c55e;border-radius:6px;margin-bottom:8px}
small{opacity:.7}
</style>
</head>

<body>

<h1>ðŸ’° Money Tracker</h1>

<div class="card">
<h3>Saldo</h3>
<h2 id="saldo">Rp 0</h2>
</div>

<div class="card">
<h3>Tambah Transaksi</h3>
<input id="desc" placeholder="Keterangan">
<input id="amount" type="number" placeholder="Jumlah">

<select id="type">
<option value="income">Pemasukan</option>
<option value="expense">Pengeluaran</option>
</select>

<select id="category">
<option>Makan</option>
<option>Transport</option>
<option>Rumah</option>
<option>Gaji</option>
<option>Lainnya</option>
</select>

<button onclick="addTx()">Tambah</button>
</div>

<div class="card">
<h3>Grafik Pengeluaran</h3>
<div id="chart"></div>
</div>

<div class="card">
<h3>Riwayat</h3>
<div id="list"></div>
<small>Tap = hapus â€¢ Tahan = edit</small>
</div>

<script>
let data = JSON.parse(localStorage.getItem('money-data') || '[]');

function rupiah(n){
  return 'Rp ' + n.toLocaleString('id-ID');
}

function render(){
  let saldo = 0;
  const list = document.getElementById('list');
  list.innerHTML = '';

  data.forEach((d,i)=>{
    saldo += d.type==='income' ? d.amount : -d.amount;

    const div = document.createElement('div');
    div.className = 'item ' + d.type;
    div.innerHTML = `
      <span>${d.desc}<br><small>${d.category}</small></span>
      <span>${rupiah(d.amount)}</span>
    `;

    div.onclick = () => {
      if(confirm('Hapus transaksi ini?')){
        data.splice(i,1);
        save();
      }
    };

    div.ontouchstart = () => div._t = setTimeout(()=>editTx(i),600);
    div.ontouchend = () => clearTimeout(div._t);

    list.appendChild(div);
  });

  document.getElementById('saldo').innerText = rupiah(saldo);
  drawChart();
}

function drawChart(){
  const box = document.getElementById('chart');
  box.innerHTML = '';

  const exp = data.filter(d=>d.type==='expense');
  if(!exp.length){
    box.innerHTML = '<small>Belum ada pengeluaran</small>';
    return;
  }

  const map = {};
  exp.forEach(d=>{
    map[d.category] = (map[d.category]||0) + d.amount;
  });

  const max = Math.max(...Object.values(map));

  Object.entries(map).forEach(([cat,val])=>{
    box.innerHTML += `
      <small>${cat} â€” ${rupiah(val)}</small>
      <div class="bar" style="width:${val/max*100}%"></div>
    `;
  });
}

function addTx(){
  const desc = document.getElementById('desc').value;
  const amount = Number(document.getElementById('amount').value);
  const type = document.getElementById('type').value;
  const category = document.getElementById('category').value;

  if(!desc || !amount) return alert('Lengkapi data');

  data.unshift({desc,amount,type,category});
  document.getElementById('desc').value='';
  document.getElementById('amount').value='';
  save();
}

function editTx(i){
  const d = data[i];
  const desc = prompt('Keterangan', d.desc);
  if(desc===null) return;
  const amt = prompt('Jumlah', d.amount);
  if(amt===null) return;
  data[i] = {...d, desc, amount:Number(amt)};
  save();
}

function save(){
  localStorage.setItem('money-data', JSON.stringify(data));
  render();
}

render();
</script>

</body>
</html>
